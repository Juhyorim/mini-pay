# Mini-Pay 기능명세

---

## Step 1. 계좌 세팅

- [x] 사용자 회원가입, 로그인 구현 
  - [x] 사용자 login_id는 중복되면 안됨
- [x] 사용자의 메인 계좌 생성
  - [x] 메인계좌 금액 추가 기능
  - [x] 인당 1일 충전 한도는 3,000,000원 예외처리
  - [x] 매일 충전 한도 초기화
- [x] 적금계좌 생성
  - [x] 메인 계좌에서 돈을 인출가능
  - [x] 메인 계좌에 돈이 없으면 인출할 수 없도록 예외처리

<br/>

### 프로그래밍 요구사항
- 적금 계좌 - 메인 계좌 간에는 트랜잭션을 신중하게 설계
- Transaction Isolation Level을 조사해보고, 어떤 단계를 사용해야 할지 생각

<br/>

## Step 2. 송금 기능 추가

- [x] 친구의 메인 계좌로 송금 기능
  - [x] 잔액이 부족하다면 10,000원 단위로 충전한 후 송금이 이루어짐
  - [x] step1의 일일 충전 한도가 적용됨
  - [x] 인당 한도는 0시 00분을 기점으로 초기화 되어야 함

### 프로그래밍 요구사항
- 나의 계좌 - 친구 계좌 간 트랜잭션을 신중하게 설계
- 최대한 트랜잭션을 짧게 가져갈 수 있도록 구상
- 한 번에 100명이 한 계좌에 송금한다고 가정하면, 이를 어떻게 처리하는게 가장 효울적?
- 언급되지 않은 시나리오 생각
- 인당 한도의 유효기간이 생각보다 짧아보이는데, 어떻게 관리하는게 좋을까?

<br/>

## Step 3. 정산 기능 추가
- [x] 1/n 정산 기능
  - [x] 사용자가 정산을 요청
  - [x] 정산을 요청받은 사용자들은 요청을 확인 후 직접 송금 - 송금완료 표시
  - [x] 남는 돈은 라임페이가 쏜다
- [x] 정산에 참여한 인원 보기
  - [x] 각 인원이 얼마를 내야하는지/ 송금이 완료됐는지 확인
- [x] 랜덤 정산 기능
  - [x] 금액을 랜덤하게 나누기

### 프로그래밍 요구사항
- 정산 금액의 합은 정확히 맞아야 함
- 정확히 나눠 떨어지지 않는 경우, 어떻게 나눌까?

<br/>

## Step 4. 송금 기능 구조 변경
- [x] 송금 생성
  - [x] 송금을 처음 보냈을 때는 Pending 상태
    - [x] 잔고는 차감됨
  - [x] 사용자가 해당 송금을 확인 가능
  - [x] 송금을 보낸 후 취소 가능
    - [x] 취소 시 보낸사람의 잔고에 반환
- [x] 사용자가 송금을 받으면 계좌에 돈이 들어옴
  - [x] Complete 상태로 변경
- [ ] 24시간 남으면 Remind 알림 발송
- [ ] 72시간 후 송금이 취소됨

### 프로그래밍 요구사항
- Pending 상태의 금액은 절대 유실되어선 안됨
- 트랜잭션 구조에 미치는 영향 파악, 동시성 문제 생각
- 상당한 대량 처리가 필요한 쿼리가 많음. 쿼리 성능을 따져가며 기능 구현을 진행해야 함

<br/>

## Step 5. 적금 기능 추가
- [x] 매일 오전 4시에 정해진 이자가 들어옴
- 상품에 따라 다른 기능 추가
  - [x] 정기 적금: 매일 오전 8시에 가입한 금액 만큼 자동으로 출금, 이율은 단리로 5%
  - [x] 자유 적금: 원할 때 돈을 넣을 수 있음. 이율은 단리로 3%
- [ ] 정기 적금 연체 시 전략 구상

### 프로그래밍 요구사항
- 돈이 없을 때 처리
- 충전 후 적금 계좌에 입금해야하는 상황이 온다면 기존 코드를 개선해야할 수도 있음
